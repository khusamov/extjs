Ext.ClassManager.registerPostprocessor("delegates", function(name, cls, data) {
	if ("delegates" in data) {
		var overrideConfig = {};
		Ext.Object.each(data.delegates, function(delegate, methods) {
			Ext.Object.each(methods, function(delegateMethodName, method) {
				method = Ext.isObject(method) ? method : { chainable: method };
				var overrideMethodName = method.name ? method.name : delegateMethodName;
				overrideConfig[overrideMethodName] = function() {
					var result = this[delegate][delegateMethodName].apply(this[delegate], arguments);
					return method.chainable ? this : result;
				};
			});
		});
		cls.override(overrideConfig);
	}
});

Ext.define("Khusamov.svg.override.dom.Element",(function(){var q=window,I=document,U="ext-window",D="ext-document",f="width",G="height",R="min-width",c="min-height",m="max-width",w="max-height",J="top",V="right",E="bottom",A="left",h="visibility",S="hidden",b="display",K="none",k="z-index",M="position",o="relative",p="static",u="-",s=/\w/g,C=/\s+/,T=/[\s]+/,a=/^(?:transparent|(?:rgba[(](?:\s*\d+\s*[,]){3}\s*0\s*[)]))$/i,B=/table-row|table-.*-group/,r={t:"border-top-width",r:"border-right-width",b:"border-bottom-width",l:"border-left-width"},Q={t:"padding-top",r:"padding-right",b:"padding-bottom",l:"padding-left"},j={t:"margin-top",r:"margin-right",b:"margin-bottom",l:"margin-left"},z=[Q.l,Q.r,Q.t,Q.b],d=[r.l,r.r,r.t,r.b],P=/\d+$/,g=/\d+(px|em|%|en|ex|pt|in|cm|mm|pc)$/i,H="px",F=/(-[a-z])/gi,W=/([a-z0-9-]+)\s*:\s*([^;\s]+(?:\s*[^;\s]+)*);?/gi,n=/^\d+(?:\.\d*)?px$/i,t={},L=function(X,Y){return Y.charAt(1).toUpperCase()},x=Ext.baseCSSPrefix+"hidden-visibility",v=Ext.baseCSSPrefix+"hidden-display",i=Ext.baseCSSPrefix+"hidden-offsets",O=Ext.baseCSSPrefix+"no-touch-scroll",l={style:"style",className:"className",cls:"cls",classList:"classList",text:"text",hidden:"hidden",html:"html",children:"children"},N,y,e;return{override:"Ext.dom.Element",_loadAttr:function(Y,X){if(Y instanceof SVGElement){return Y[X].baseVal}else{return Y[X]}},_saveAttr:function(Y,X,Z){if(Y instanceof SVGElement){Y[X].baseVal=Z}else{Y[X]=Z}},addCls:function(af,ad,ah){var ag=this,ai,ab,Y,Z,ac,ae,X,aa=ag.getData();if(!af){return ag}if(!aa.isSynchronized){ag.synchronize()}ab=ag.dom;Y=aa.classMap;Z=aa.classList;ad=ad?ad+u:"";ah=ah?u+ah:"";if(typeof af==="string"){af=af.split(C)}for(ac=0,ae=af.length;ac<ae;ac++){X=ad+af[ac]+ah;if(!Y[X]){Y[X]=true;Z.push(X);ai=true}}if(ai){ag._saveAttr(ab,"className",Z.join(" "))}return ag},setCls:function(aa){var ac=this,Z=ac.getData(),ad=Z.classMap,Y,ab,X;if(typeof aa==="string"){aa=aa.split(C)}for(Y=0,ab=aa.length;Y<ab;Y++){X=aa[Y];if(!ad[X]){ad[X]=true}}Z.classList=aa.slice();ac._saveAttr(ac.dom,"className",aa.join(" "))},removeCls:function(af,ad,ah){var ag=this,ai,ab,Y,Z,ac,ae,X,aa=ag.getData();if(!af){return ag}if(!aa.isSynchronized){ag.synchronize()}if(!ah){ah=""}ab=ag.dom;Y=aa.classMap;Z=aa.classList;ad=ad?ad+u:"";ah=ah?u+ah:"";if(typeof af==="string"){af=af.split(C)}for(ac=0,ae=af.length;ac<ae;ac++){X=ad+af[ac]+ah;if(Y[X]){delete Y[X];Ext.Array.remove(Z,X);ai=true}}if(ai){ag._saveAttr(ab,"className",Z.join(" "))}return ag},synchronize:function(){var ae=this,aa=ae.dom,af={},ad=ae._loadAttr(aa,"className"),Y,ab,ac,X,Z=ae.getData();if(ad&&ad.length>0){Y=ae._loadAttr(aa,"className").split(T);for(ab=0,ac=Y.length;ab<ac;ab++){X=Y[ab];af[X]=true}}else{Y=[]}Z.classList=Y;Z.classMap=af;Z.isSynchronized=true;return ae},set:function(X,Y){var aa=this,ac=aa.dom,Z,ab;for(Z in X){if(X.hasOwnProperty(Z)){ab=X[Z];if(Z==="style"){aa.applyStyles(ab)}else{if(Z==="cls"){aa._saveAttr(ac,"className",ab)}else{if(Y!==false){if(ab===undefined){ac.removeAttribute(Z)}else{ac.setAttribute(Z,ab)}}else{ac[Z]=ab}}}}}return aa}}})());Ext.define("Khusamov.override.util.Format",{override:"Ext.util.Format",ruMoney:function(a){return Ext.util.Format.currency(a," руб.",2,true)}});Ext.onReady(function(){if(Ext.util&&Ext.util.Format){Ext.apply(Ext.util.Format,{thousandSeparator:" "})}});Ext.define("Khusamov.override.data.Store",{override:"Ext.data.Store",listeners:{beforeload:function(b,a){if("combobox" in b&&b.combobox instanceof Ext.form.field.ComboBox){var c={};c[b.combobox.getComboboxParam()]=b.combobox.getValue();a.setParams(Ext.Object.merge(a.getParams()||{},c))}}}});Ext.define("Khusamov.override.util.History",{override:"Ext.util.History",enabled:true,enable:function(){var a=this;if(!a.enabled){a.enabled=true;a.un("change","fixhash",a)}},disable:function(){var a=this;if(a.enabled){a.enabled=false;a.fixedhash=window.location.hash;a.on("change","fixhash",a)}},fixhash:function(a){window.location.hash=this.fixedhash}});Ext.define("Khusamov.override.data.TreeModel",{override:"Ext.data.TreeModel",getPath:function(e,d,a){e=e||this.idProperty;d=d||"/";var c=[this.get(e)],b=this.parentNode;while(b){var f=Ext.String.trim(b.get(e));if(f){c.unshift(f)}b=b.parentNode}return(a?"":d)+c.join(d)}});Ext.define("Khusamov.override.resizer.Splitter",{override:"Ext.resizer.Splitter",style:{backgroundColor:"rgb(175, 175, 175)"}});Ext.define("Khusamov.override.grid.Panel",{override:"Ext.grid.Panel",emptyText:"Данных для отображения нет.",viewConfig:{deferEmptyText:false},rowLines:false});Ext.define("Khusamov.override.dd.DragTracker",{override:"Ext.dd.DragTracker",tolerance:0});Ext.define("Khusamov.override.window.Window",{override:"Ext.window.Window",ghost:false,resizable:{dynamic:true},shadow:false,style:{borderColor:"rgb(219, 219, 219)"},bodyPadding:10,onShow:function(){var a=this;a.callParent(arguments);if(a.modal){Ext.util.History.disable()}},onHide:function(){var a=this;a.callParent(arguments);if(a.modal){Ext.util.History.enable()}}});Ext.define("Khusamov.override.form.FieldSet",{override:"Ext.form.FieldSet",padding:"5px 7px 5px 7px"});Ext.define("Khusamov.override.form.Panel",{override:"Ext.form.Panel",border:false,getIsValid:function(){return this.isValid()}});Ext.define("Khusamov.override.form.field.Number",{override:"Ext.form.field.Number",decimalSeparator:"."});Ext.define("Khusamov.override.form.field.ComboBox",{override:"Ext.form.field.ComboBox",minChars:0,config:{comboboxParam:"combobox"},initComponent:function(){this.callParent();this.store.combobox=this}});Ext.define("Khusamov.override.menu.Item",{override:"Ext.menu.Item",padding:"3px 10px 3px 10px"});Ext.define("Khusamov.override.menu.Separator",{override:"Ext.menu.Separator",padding:0});Ext.define("Khusamov.override.menu.Menu",{override:"Ext.menu.Menu",shadow:false});Ext.define("Khusamov.override.window.Toast",{override:"Ext.window.Toast",align:"t",bodyPadding:"20px 30px 20px 30px",slideInDuration:500,hideDuration:800});Ext.define("Khusamov.browser.Console",{alternateClassName:"Khusamov.Console",singleton:true,constructor:function(){var a=this;a.namespace=null;a.init()},setNamespace:function(a){this.namespace=a},init:function(){var c=this;var d=window.location.pathname.split("/");d.pop();var a=d.join("/")+"/";function b(f){try{throw Error()}catch(k){var h=k.stack.split("\n")[f||4].split("(");var i=(h[1]?h[1]:h[0]).split(")")[0].split(":");var j=i[2];var g=h[1]?h[0].split("at ")[1].trim():"Не определено";i=i[1].split(window.location.hostname)[1].split("?")[0];i=i.replace(a,"");return i+":"+j}}console.$log=console.log;console.log=function(){var e=Ext.Array.slice(arguments);if(c.namespace){e.unshift(c.namespace,"|")}return console.$log.apply(console,e)};console.$info=console.info;console.info=function(){var e=Ext.Array.slice(arguments);if(c.namespace){e.unshift(c.namespace,"|")}e.push("|",b());return this.$info.apply(console,e)}}});Ext.define("Khusamov.dom.InlineFrame",{extend:"Ext.ux.IFrame",alias:"widget.inlineframe",loadMask:"<div style='text-align: center'>Подождите,<br/>загружается страница...</div>",reload:function(){this.load(this.getFrame().src)},getHead:function(){var a=this.getDoc();return a.head||a.getElementsByTagName("head")[0]},getRandomSuffixId:function(){return"-iframe-"+Math.round(Math.random()*100000)},getRandomId:function(a){return a+this.getRandomSuffixId()},setWinDocRandomId:function(){this._prevdocid=this.getDoc().id;this._prevwinid=this.getWin().id;this.getDoc().id=this.getRandomId("ext-document");this.getWin().id=this.getRandomId("ext-window")},unsetWinDocRandomId:function(){this.getDoc().id=this._prevdocid;this.getWin().id=this._prevwinid},onLoad:function(){this.setWinDocRandomId();this.callParent();this.unsetWinDocRandomId()},cleanupListeners:function(){this.setWinDocRandomId();this.callParent();this.unsetWinDocRandomId()}});Ext.define("Khusamov.override.Override",{requires:["Khusamov.override.data.Store","Khusamov.override.data.TreeModel","Khusamov.override.form.Panel","Khusamov.override.form.FieldSet","Khusamov.override.form.field.Number","Khusamov.override.form.field.ComboBox","Khusamov.override.menu.Menu","Khusamov.override.menu.Item","Khusamov.override.menu.Separator","Khusamov.override.window.Window","Khusamov.override.window.Toast","Khusamov.override.grid.Panel","Khusamov.override.dd.DragTracker","Khusamov.override.resizer.Splitter","Khusamov.override.util.History","Khusamov.override.util.Format"]});Ext.define("Khusamov.svg.layout.Svg",{extend:"Ext.layout.container.Container",alias:"layout.khusamov-layout-svg",type:"khusamov-layout-svg",renderTpl:["{%this.renderContent(out,values)%}"],getItemLayoutEl:function(c){var d=c.el?c.el.dom:Ext.getDom(c),a=d.parentNode,b;if(a){b=this._loadAttr(a,"className");if(b&&b.indexOf(Ext.baseCSSPrefix+"resizable-wrap")!==-1){d=d.parentNode}}return d},_loadAttr:function(b,a){if(b instanceof SVGElement){return b[a].baseVal}else{return b[a]}}});Ext.define("Khusamov.svg.element.attribute.transform.Filter",{requires:["Ext.draw.Matrix"],statics:{toObject:function(a){a=a.replace(/\)/g,"");a=a.split("(");return{type:a[0].trim(),params:a[1].split(",").map(function(b){return Number(b)})}},createMatrix:function(a,b){return this["createMatrix"+a[0].toUpperCase()+a.substr(1)].call(this,b)},createMatrixMatrix:function(a){return Ext.create("Ext.draw.Matrix",a[0],a[1],a[2],a[3],a[4],a[5])},createMatrixTranslate:function(c){var b=c[0];var a=c[1];return Ext.create("Ext.draw.Matrix",1,0,0,1,b,a)},createMatrixScale:function(b){var c=b[0];var a=b[1]===undefined?c:b[1];return Ext.create("Ext.draw.Matrix",c,0,0,a,0,0)},createMatrixRotate:function(a){},createMatrixSkewx:function(a){},createMatrixSkewy:function(a){}},config:{type:null,params:[]},constructor:function(a){var c=this;if(arguments.length>1){a=Ext.Array.slice(arguments)}if(Ext.isArray(a)){var b=a.shift();a={type:b,params:a}}if(Ext.isString(a)){a=Khusamov.svg.element.attribute.transform.Filter.toObject(a)}if(a instanceof Ext.draw.Matrix){a={type:"matrix",params:a.toVerticalArray()}}c.initConfig(a)},applyParams:function(a){if(Ext.isString(a)){a=a.split(",")}a=a.map(function(b){return Number(b)});a=a.filter(function(b){return b!==undefined});return a},toMatrix:function(){return Khusamov.svg.element.attribute.transform.Filter.createMatrix(this.getType(),this.getParams())},toString:function(){return this.getType().concat("(",this.getParams().join(", "),")")},toObject:function(b){var a={type:this.getType(),params:this.getParams()};if(b){a.matrix=this.toMatrix()}return a},clone:function(){return new this.self(this.toObject())}});Ext.define("Khusamov.svg.element.attribute.transform.Transform",{alternateClassName:"Khusamov.svg.element.attribute.Transform",requires:["Khusamov.svg.element.attribute.transform.Filter"],mixins:["Ext.mixin.Observable"],statics:{toArray:function(c){var a=[];var b=Khusamov.svg.element.attribute.transform.Filter;if(c){if(Ext.isString(c)||c instanceof b||c instanceof Ext.draw.Matrix){c=[c]}c.forEach(function(d){if(d instanceof b){a.push(d)}else{if(d instanceof Ext.draw.Matrix){a.push(new b(d))}else{d=d.replace(/,/g," ");d=d.split(")");d=d.filter(function(e){return e.trim()});d=d.map(function(e){return e.replace(/ /g,", ")+")"});d.forEach(function(e){a.push(new b(e))})}}})}return a}},config:{filters:[]},constructor:function(a){var b=this;b.mixins.observable.constructor.call(b,a);if(Ext.isString(a)||Ext.isArray(a)||a instanceof Ext.draw.Matrix||a instanceof Khusamov.svg.element.attribute.transform.Filter){a={filters:a}}b.initConfig(a)},applyFilters:function(a){return Khusamov.svg.element.attribute.Transform.toArray(a)},updateFilters:function(b,a){this.fireEvent("update","clear");if(b.length){this.fireEvent("update","add",b)}},add:function(d){var c=this;var a=Khusamov.svg.element.attribute.transform.Filter;var b=Khusamov.svg.element.attribute.Transform;if(Ext.isString(d)||Ext.isArray(d)||d instanceof Ext.draw.Matrix||d instanceof Khusamov.svg.element.attribute.transform.Filter){if(arguments.length>1){d=[a.create.apply(a,Ext.Array.slice(arguments))]}else{d=b.toArray(d)}}else{d=[a.create(d)]}c.getFilters().push.apply(c.getFilters(),d);c.fireEvent("update","add",d);return c},matrix:function(e,d,a,f,c,b){if(e instanceof Ext.draw.Matrix){return this.add(e)}else{return this.add("matrix",e,d,a,f,c,b)}},translate:function(b,a){return this.add("translate",b,a)},scale:function(b,a){return this.add("scale",b,a)},rotate:function(b,a,c){return this.add("rotate",b,a,c)},skewx:function(a){return this.add("skewx",a)},skewy:function(a){return this.add("skewy",a)},clear:function(){return this.setFilters()},each:function(a){this.getFilters().forEach(a);return this},count:function(){return this.getFilters().length},toMatrix:function(){var b=this;var a=Ext.create("Ext.draw.Matrix");b.each(function(c){a.multiply(c.toMatrix())});return a},toString:function(){var a=[];this.each(function(b){a.push(b.toString())});return a.join(" ")}});Ext.define("Khusamov.svg.geometry.Primitive",{requires:["Ext.data.identifier.Sequential"],mixins:["Ext.mixin.Observable"],statics:{identifier:null,init:function(){var a=this;a.identifier=Ext.create("Ext.data.identifier.Sequential",{seed:1000})},generateId:function(){return this.identifier.generate()}},isPrimitive:true,type:"primitive",config:{id:null,index:null,title:null,description:null},constructor:function(a){var b=this;if(a&&!("id" in a)){a.id=Khusamov.svg.geometry.Primitive.generateId()}b.mixins.observable.constructor.call(b,a);b.initConfig(a);b.initPrimitive()},applyId:function(a){return String(a)},applyIndex:function(a){return Number(a)},applyTitle:function(a){return String(a)},applyDescription:function(a){return String(a)},updateId:function(b,a){this.fireEvent("update","id",b,a,this)},updateIndex:function(b,a){this.fireEvent("update","id",b,a,this)},updateTitle:function(b,a){this.fireEvent("update","id",b,a,this)},updateDescription:function(b,a){this.fireEvent("update","id",b,a,this)},getType:function(){return this.type},initPrimitive:Ext.emptyFn,clone:function(){return new this.self(this.toObject())},toObject:function(){return{type:this.getType(),id:this.getId(),index:this.getIndex(),title:this.getTitle(),description:this.getDescription()}},toArray:function(){return[]},toString:function(){return String()}},function(a){a.init()});Ext.define("Khusamov.svg.geometry.Angle",{statics:{DEGREE:"degree",RADIAN:"radian",degree:function(a){return Ext.create("Khusamov.svg.geometry.Angle",a*Math.PI/180)},radian:function(a){return Ext.create("Khusamov.svg.geometry.Angle",a)}},config:{value:0},constructor:function(a,c){var b=this;if(Ext.isNumber(a)||Ext.isString(a)){c=c||Khusamov.svg.geometry.Angle.RADIAN;a={value:a*(c==Khusamov.svg.geometry.Angle.RADIAN?1:Math.PI/180)}}b.initConfig(a)},applyValue:function(a){return Number(a)},get:function(c,b){c=(c?c:Khusamov.svg.geometry.Angle.RADIAN).toLowerCase();var a=this["get"+c[0].toUpperCase()+c.substr(1)].call(this);return b===undefined?a:a.toFixed(b)},getDegree:function(){return this.getValue()*180/Math.PI},getRadian:function(){return this.getValue()},toNumber:function(a){return this.get(a)}});Ext.define("Khusamov.svg.geometry.Point",{extend:"Khusamov.svg.geometry.Primitive",requires:["Khusamov.svg.geometry.Angle"],statics:{distance:function(a){a=arguments.length==2?Ext.Array.slice(arguments):a;a=a instanceof Khusamov.svg.geometry.Point?a.toArray():a;return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))}},isPoint:true,type:"point",config:{x:0,y:0},constructor:function(a){var b=this;if(arguments.length==2){a=Ext.Array.slice(arguments)}if(a instanceof Khusamov.svg.geometry.Point){a=a.toArray()}if(Ext.isArray(a)){a={x:a[0],y:a[1]}}b.callParent([a])},applyX:function(a){return Number(a)},applyY:function(a){return Number(a)},updateX:function(b,a){this.fireEvent("update","x",this,b,a)},updateY:function(b,a){this.fireEvent("update","y",this,b,a)},x:function(){return this.getX()},y:function(){return this.getY()},equal:function(){var d=this;var b=[],c;if(Ext.isNumber(arguments[0])){b[0]=arguments[0];b[1]=arguments[1];c=arguments[2]||0}else{b=arguments[0];c=arguments[1]||0}b=Khusamov.svg.geometry.Point.create(b);var a=b.x()<=d.x()+c&&b.x()>=d.x()-c;a=a&&b.y()<=d.y()+c&&b.y()>=d.y()-c;return a},moveTo:function(){var c=this;var a=arguments.length==2?Ext.Array.slice(arguments):arguments[0];a=a instanceof Khusamov.svg.geometry.Point?a.toArray():a;var b=c.toArray();c.suspendEvents();c.setX(c.applyX(a[0]));c.setY(c.applyY(a[1]));c.resumeEvents();c.fireEvent("update","move",c,a,b);return c},move:function(){return this.moveTo.apply(this,arguments)},moveBy:function(){var a=Khusamov.svg.geometry.Point.create.apply(Khusamov.svg.geometry.Point,arguments);return this.moveTo(this.x()+a.x(),this.y()+a.y())},distance:function(b){var g=this;var a=0;if(Ext.isArray(b)){b=Ext.create("Khusamov.svg.geometry.Point",b)}var d=g.x();var f=g.y();var c=b?b.x():0;var e=b?b.y():0;a=Khusamov.svg.geometry.Point.distance(c-d,e-f);return a},getDistanceTo:function(a){return this.distance.apply(this,arguments)},getPolar:function(){return[this.getAngle(),this.getRadius()]},setPolar:function(d){var c=this;d=arguments.length==2?Ext.Array.slice(arguments):d;d=d instanceof Khusamov.svg.geometry.Point?d.getPolar():d;var e=d[0];var b=d[1];var a=b*Math.cos(e);var f=b*Math.sin(e);return c.moveTo(a,f)},getRadius:function(){return this.distance()},setRadius:function(a){var b=this;var c=a*Math.sqrt(Math.pow(b.x(),2)+Math.pow(b.y(),2));return b.moveTo(b.x()/c,b.y()/c)},getAngle:function(b,a){return Khusamov.svg.geometry.Angle.create(Math.atan2(this.y(),this.x())+Math.PI).get(b,a)},setAngle:function(d){var c=this;var b=Math.sqrt(Math.pow(c.x(),2)+Math.pow(c.y(),2));var a=b*Math.cos(d);var e=b*Math.sin(d);return c.moveTo(a,e)},toObject:function(){return Ext.Object.merge(this.callParent(),{x:this.x(),y:this.y()})},toArray:function(){return[this.x(),this.y()]},toString:function(a){var b=function(c){return a!==undefined?c.toFixed(a):c};return String(b(this.x()))+", "+String(b(this.y()))}});Ext.define("Khusamov.svg.element.Element",{extend:"Ext.container.Container",alternateClassName:"Khusamov.svg.Element",requires:["Khusamov.svg.layout.Svg","Khusamov.svg.element.attribute.transform.Transform","Ext.draw.Matrix","Khusamov.svg.geometry.Point"],xtype:"khusamov-svg-element",isSvgElement:true,type:"element",baseCls:Ext.baseCSSPrefix+"khusamov-svg-element",layout:"khusamov-layout-svg",defaultType:null,statics:{createElement:function(a){a.xtype=a.xtype?a.xtype:"khusamov-svg-element-"+a.type;return Ext.create(a)}},geometryClass:null,geometryAttributeName:"points",geometry:null,transform:null,config:{geometry:null,transform:null,boundPosition:[0,0]},constructor:function(a){var b=this;if(b.geometryClass){b.geometryClass=Khusamov.svg.geometry[b.geometryClass]}b.callParent([a])},initComponent:function(){var a=this;a.callParent();if(a.geometryClass&&!a.getGeometry()){a.setGeometry()}if(!a.getTransform()){a.setTransform()}a.initElement()},initElement:Ext.emptyFn,applyGeometry:function(a){return a instanceof this.geometryClass?a:new this.geometryClass(a)},updateGeometry:function(c,a){var b=this;b.geometry=c;b.repaintGeometry();if(a){a.un("update","onUpdateGeometryInner",b)}c.on("update","onUpdateGeometryInner",b);b.fireEvent("update","clear");b.fireEvent("update","add",c)},onUpdateGeometryInner:function(b,a){var c=this;c.repaintGeometry();c.fireEvent("update",b,a)},repaintGeometry:function(){var b=this;if(b.geometryClass&&b.rendered){var a={};a[b.geometryAttributeName]=b.geometry.toString();b.getEl().set(a)}},applyTransform:function(b){var a=Khusamov.svg.element.attribute.Transform;return b instanceof a?b:new a(b)},updateTransform:function(a,c){var b=this;b.transform=a;b.repaintTransform();if(c){c.un("update","onUpdateTransformFilters",b)}a.on("update","onUpdateTransformFilters",b);b.fireEvent("update","transform");b.fireEvent("transform")},onUpdateTransformFilters:function(){var a=this;a.repaintTransform();a.fireEvent("update","transform");a.fireEvent("transform")},repaintTransform:function(){var a=this;if(a.rendered&&a.getTransform().count()){a.getEl().set({transform:a.transform.toString()})}},afterRender:function(){var a=this;a.callParent(arguments);a.repaintGeometry();a.repaintTransform();a._setSize(a.width,a.height)},applyBoundPosition:function(a){return Ext.isArray(a)?Ext.create("Khusamov.svg.geometry.Point",a):a},updateBoundPosition:function(a,b){var c=this;if(b){b.un("update","onUpdateElementBoundPosition",c)}a.on("update","onUpdateElementBoundPosition",c)},onUpdateElementBoundPosition:function(){this.fireEvent("update")},getMatrix:function(b){var c=this;var a=Ext.create("Ext.draw.Matrix");if(b===true&&c.up() instanceof Khusamov.svg.element.Element){a=c.up().getMatrix(b)}a.multiply(c.transform.toMatrix());return a},add:function(){var a=this;var b="khusamov-svg-element-";var c=function(d){if(Ext.isObject(d)&&d.type&&!("xtype" in d)){d.xtype=b+d.type}};Ext.Array.each(arguments,function(d){if(Ext.isArray(d)){d.forEach(c)}else{c(d)}});return a.callParent(arguments)},setPagePosition:function(a,c){var b=this;b.setX(a);b.setY(c);return b},setX:function(a){var b=this;var d=b.getSurface().getTransformMatrix().getScaleX();var c=b.getSurface().getTransformMatrix().getDX();a=a-b.getSvg().getX();a-=c;a/=d;b.getEl().set({x:a});return b},setY:function(d){var a=this;var c=a.getSurface().getTransformMatrix().getScaleY();var b=a.getSurface().getTransformMatrix().getDY();d=d-a.getSvg().getY();d-=b;d/=c;a.getEl().set({y:d});return a},setSize:function(b,a){var c=this;c.callParent(arguments);c._setSize(b,a);return c},_setSize:function(b,a){var c=this;if(c.rendered){c.getEl().setStyle("width",null);c.getEl().setStyle("height",null);c.getEl().set({width:b,height:a})}return c}});Ext.define("Khusamov.svg.Svg",{extend:"Khusamov.svg.element.Element",alternateClassName:"Khusamov.Svg",xtype:"khusamov-svg",isSvg:true,type:"svg",baseCls:Ext.baseCSSPrefix+"khusamov-svg",autoEl:{tag:"svg",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},function(a){Khusamov.svg.Element.override({statics:{createSvg:function(){return a.create.apply(a,arguments)}},svg:null,getSvg:function(){var b=this;if(!b.svg){b.svg=b.up("khusamov-svg")}return b.svg}})});Ext.define("Khusamov.svg.element.Group",{extend:"Khusamov.svg.element.Element",xtype:"khusamov-svg-element-group",isSvgGroup:true,type:"group",baseCls:Ext.baseCSSPrefix+"khusamov-svg-group",autoEl:{tag:"g"}},function(a){Khusamov.svg.Element.override({statics:{createGroup:function(){return a.create.apply(a,arguments)}}})});Ext.define("Khusamov.svg.desktop.surface.Layer",{extend:"Khusamov.svg.element.Group",xtype:"khusamov-svg-desktop-surface-layer",baseCls:Ext.baseCSSPrefix+"khusamov-svg-desktop-surface-layer"});Ext.define("Khusamov.svg.desktop.surface.Surface",{extend:"Khusamov.svg.element.Group",xtype:"khusamov-svg-desktop-surface",requires:["Khusamov.svg.desktop.surface.Layer"],baseCls:Ext.baseCSSPrefix+"khusamov-svg-desktop-surface",config:{scaleValue:100,scaleMin:10,scaleMax:500,scalable:{enable:true,value:100,min:10,max:500}},scalePrevious:1,initComponent:function(){var a=this;a.callParent(arguments);a.on("render","initScalable",a,{single:true})},initScalable:function(){var d=this;var f=d.getDesktop();var c=f.getEl();var b=0;var a=-10;var e=10;c.on("mousewheel",function(h){b+=h.event.wheelDelta>0?1:-1;if(b<a){b=a}if(b>e){b=e}var g=Math.exp(b/5);d.fireEvent("scale",g);d.scale(g,[h.pageX-f.getX(),h.pageY-f.getY()])})},privates:{onDesktopMouseWheel:function(){var a=this}},scale:function(f,b){var d=this;var e=d.getMatrix();var c=f/d.scalePrevious;b=d.getMatrix(true).inverse().transformPoint(b);var a=b[0];var g=b[1];e.translate(a,g);e.scale(c);e.translate(-a,-g);d.transform.clear();d.transform.matrix(e);d.scalePrevious=f;return d},createLayer:function(a){var b=this;if(Ext.isString(a)){a={itemId:a}}return Ext.create("Khusamov.svg.desktop.surface.Layer",a)},getLayer:function(a){return this.down("khusamov-svg-desktop-surface-layer#"+a)},getDesktop:function(){return this.getSvg()}});Ext.define("Khusamov.svg.desktop.Board",{extend:"Khusamov.svg.element.Group",xtype:"khusamov-svg-desktop-board",requires:["Khusamov.svg.desktop.surface.Surface"],baseCls:Ext.baseCSSPrefix+"khusamov-svg-desktop-board",surface:null,config:{translatable:true},initComponent:function(){var a=this;a.callParent(arguments);a.surface=a.add(Ext.create("Khusamov.svg.desktop.surface.Surface"));a.on("render","initTranslatable",a,{single:true})},initTranslatable:function(){var d=this;var f=d.getDesktop();var a=f.getEl();var b=false;var e=0;var c=0;a.on("mousedown",function(h){if(h.button==1){b=true;var g=d.getMatrix();e=h.pageX-f.getX()-g.getDX();c=h.pageY-f.getY()-g.getDY();a.addCls("move2")}});a.on("mouseup",function(){b=false;a.removeCls("move2")});a.on("mouseout",function(){b=false;a.removeCls("move2")});a.on("mousemove",function(j){if(b){var h=j.pageX-f.getX()-e;var k=j.pageY-f.getY()-c;var i=d.getMatrix();var g=i.inverse().transformPoint([h,k]);h=g[0];k=g[1];i.translate(h,k);d.transform.clear();d.transform.matrix(i)}})},getDesktop:function(){return this.getSvg()},getSurface:function(){return this.surface}});Ext.define("Khusamov.svg.desktop.Desktop",{alternateClassName:"Khusamov.svg.Desktop",extend:"Khusamov.svg.Svg",xtype:"khusamov-svg-desktop",requires:["Khusamov.svg.desktop.Board"],baseCls:Ext.baseCSSPrefix+"khusamov-svg-desktop",rulers:[],board:null,initComponent:function(){var a=this;a.callParent(arguments);a.board=a.add(Ext.create("Khusamov.svg.desktop.Board"))},getBoard:function(){return this.board}});Ext.define("Khusamov.svg.desktop.Handle",{extend:"Khusamov.svg.element.Group",xtype:"khusamov-svg-desktop-handle",baseCls:Ext.baseCSSPrefix+"khusamov-svg-desktop-handle",config:{controlled:null},constructor:function(a){var b=this;if(a instanceof Khusamov.svg.desktop.surface.Piece){a={controlled:a}}b.callParent([a])},initComponent:function(){var a=this;a.callParent(arguments);a.on("added",function(){a.getSurface().on("transform","onSurfaceTransform",a)},a,{single:true})},onSurfaceTransform:function(){var a=this},getSurface:function(){var a=this;return a.getDesktop().getBoard().getSurface()},getDesktop:function(){return this.getSvg()},destroy:function(){var a=this;a.getSurface().un("transform","onSurfaceTransform",a);a.callParent(arguments)}});Ext.define("Khusamov.svg.desktop.Panel",{extend:"Ext.panel.Panel",xtype:"khusamov-svg-desktop-panel",requires:["Khusamov.svg.desktop.Desktop"],layout:"fit",desktop:null,initComponent:function(){var a=this;a.callParent(arguments);a.desktop=a.add(Ext.create("Khusamov.svg.Desktop"));a.desktop.board.surface.on("scale",function(b){a.down("#scale").setValue(b*10/0.1353352832366127)})},bbar:["->",{itemId:"scale",xtype:"slider",width:300,value:50,increment:((7.3890560989306495*10/0.1353352832366127)-10)/20,minValue:10,maxValue:7.3890560989306495*10/0.1353352832366127,readOnly:true}],getDesktop:function(){return this.desktop}});Ext.define("Khusamov.svg.desktop.surface.Piece",{extend:"Khusamov.svg.element.Group",xtype:"khusamov-svg-desktop-surface-piece",baseCls:Ext.baseCSSPrefix+"khusamov-svg-desktop-surface-piece",initComponent:function(){var a=this;a.callParent();a.initPiece()},initPiece:Ext.emptyFn});Ext.define("Khusamov.svg.discrete.graph.AdjacencyList",{config:{directed:false},constructor:function(a){this.graph={};this.initConfig(a)},add:function(a,c){if(arguments.length==3){var b={};b[arguments[1]]=arguments[2];c=b}this.graph[a]=Ext.applyIf(this.graph[a]||{},c);if(!this.getDirected()){Ext.Object.each(c,function(d,e){this.graph[d]=this.graph[d]||{};this.graph[d][a]=e})}return this},getAdjacent:function(a){return Ext.Object.merge({},this.getForwardAdjacent(a),this.getBackAdjacent(a))},getForwardAdjacent:function(a){return this.graph[a]},getBackAdjacent:function(b){var c=this,a={};Ext.Object.each(c.graph,function(d,e){if(b in e){a[d]=e[b]}});return a},getWeight:function(b,a){return this.graph[b][a]},getPathWeight:function(c){var b=this,a=0;var d=c[0];c.forEach(function(f,e){if(e){a+=b.getWeight(d,f);d=f}});return a},each:function(b,a){Ext.Object.each(this.graph,b,a)},findBackPath:function(a){var d=this;var c=this.findPath(a);var b={weight:Infinity};Ext.Object.each(d.getBackAdjacent(a),function(e,f){f+=d.getPathWeight(c[e]);if(f<b.weight){b.weight=f;b.index=e}});return c[b.index]},findPath:function(g,f){var e={};var d={};var b=[];this.each(function(h){e[h]=Infinity});e[g]=0;var c;console.groupCollapsed(g);console.log(this.graph);do{c=null;Ext.Object.each(this.graph,function(h){if(!Ext.Array.contains(b,h)){if(c==null||e[h]<e[c]){c=h}}});if(c!=null){b.push(c);Ext.Object.each(this.getForwardAdjacent(c),function(h,i){if(!Ext.Array.contains(b,h)){if(e[h]>e[c]+i){e[h]=e[c]+i;d[h]=Ext.Array.clone(d[c]||[]);d[h].push(h)}}});var a={};Ext.Object.each(this.graph,function(h){a[h]=e[h].toFixed(0)});console.info("distance",a)}}while(c!=null);Ext.Object.each(d,function(h,i){i.unshift(g)});console.info("visited",b);console.info("path",d);console.groupEnd();return f==undefined?d:d[f]}});Ext.define("Khusamov.svg.element.Circle",{extend:"Khusamov.svg.element.Element",requires:["Khusamov.svg.geometry.Point"],xtype:"khusamov-svg-element-circle",isSvgCircle:true,type:"circle",baseCls:Ext.baseCSSPrefix+"khusamov-svg-circle",autoEl:{tag:"circle"},privates:{onUpdateCenterPoint:function(){var a=this;a.getEl().set({cx:a.center.x(),cy:a.center.y()})}},center:null,radius:0,config:{center:[0,0],radius:0},constructor:function(a){var b=this;if(arguments.length>1){a=(arguments.length==3)?{center:[arguments[0],arguments[1]],radius:arguments[2]}:{center:arguments[0],radius:arguments[1]}}b.callParent([a])},applyCenter:function(a){var b=this;if(!(a instanceof Khusamov.svg.geometry.Point)){a=Ext.create("Khusamov.svg.geometry.Point",a)}if(b.getCenter()){b.getCenter().un("update","onUpdateCenterPoint",b)}a.on("update","onUpdateCenterPoint",b);return a},updateCenter:function(a,b){var c=this;c.center=a;if(c.rendered){c.getEl().set({cx:a.x(),cy:a.y()})}},updateRadius:function(a,b){var c=this;c.radius=a;if(c.rendered){c.getEl().set({r:a})}},afterRender:function(){var a=this;a.callParent(arguments);a.getEl().set({cx:a.center.x(),cy:a.center.y(),r:a.radius})},setX:function(a){var b=this;var d=b.getMatrix(true).getScaleX();var c=b.getMatrix(true).getDX();a=a-b.getSvg().getX();a-=c;a/=d;a+=b.radius;b.center.setX(a);return b},setY:function(d){var a=this;var c=a.getMatrix(true).getScaleY();var b=a.getMatrix(true).getDY();d=d-a.getSvg().getY();d-=b;d/=c;d+=a.radius;a.center.setY(d);return a}},function(a){Khusamov.svg.Element.override({statics:{createCircle:function(){return a.create.apply(a,arguments)}}})});Ext.define("Khusamov.svg.element.Image",{extend:"Ext.Component",alias:"widget.managedimage",autoEl:{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"my-managed-image"},beforeRender:function(){this.autoEl=Ext.merge({},this.autoEl,this.initialConfig);console.log(this.autoEl);this.callParent(arguments)},onLoad:function(){this.fireEvent("load",this)},setSrc:function(a){if(this.rendered){this.el.dom.src=a}else{this.src=a}},getSrc:function(a){return this.el.dom.src||this.src}});Ext.define("Khusamov.svg.geometry.point.Collection",{extend:"Ext.util.Collection",requires:["Ext.data.identifier.Sequential"],listeners:{add:"reindex",remove:"reindex"},constructor:function(){var a=this;a.callParent(arguments);a.identifier=Ext.create("Ext.data.identifier.Sequential")},reindex:function(){var a=this;a.each(function(b,c,d){b.setIndex(c);b.isFirst=(c==0);b.isLast=(c==d-1)});return a},add:function(a){var b=this;if(!Ext.isArray(a)){a=[a]}a.map(function(d){var c=b.getKey(d);if(c===undefined||c===null){b.setKey(d)}return d});return b.callParent(a)},setKey:function(a,b){b=b||this.identifier.generate();if(a.setId){a.setId(b)}else{a.id=b}return this}});Ext.define("Khusamov.svg.geometry.Polyline",{extend:"Khusamov.svg.geometry.Primitive",requires:["Khusamov.svg.geometry.Point","Khusamov.svg.geometry.point.Collection"],uses:["Khusamov.svg.geometry.Line"],statics:{parseSvgPointString:function(b){var a=[];return a},toCollection:function(c){var d=Khusamov.svg.geometry.Point;var b=Khusamov.svg.geometry.point.Collection;var a=c instanceof b?c.clone():new b();if(Ext.isString(c)){c=this.parseSvgPointString(c)}if(Ext.isArray(c)){c=c.map(function(e,f){return e instanceof d?e:new d(e)});a.add(c)}return a}},privates:{},isPolyline:true,type:"polyline",points:null,config:{points:null},constructor:function(a){var b=this;if(Ext.isString(a)||Ext.isArray(a)){a={points:a}}b.callParent([a])},initPrimitive:function(){var a=this;if(!a.points){a.setPoints()}},applyPoints:function(a){var b=this;a=Khusamov.svg.geometry.Polyline.toCollection(a);return a},updatePoints:function(b,a){var c=this;c.points=b;c.removePointCollectionListeners(a);c.addPointCollectionListeners(b);this.fireEvent("update","clear");this.fireEvent("update","add",b)},addPointCollectionListeners:function(b){var a=this;b.on({scope:a,add:"onAddPoints",remove:"onRemovePoints"});b.each(function(c){a.addPointListeners(c)})},removePointCollectionListeners:function(b){var a=this;if(b){b.un({scope:a,add:"onAddPoints",remove:"onRemovePoints"});b.each(function(c){a.removePointListeners(c)})}},addPointListeners:function(a){a.on("update","onUpdatePoint",this)},removePointListeners:function(a){a.un("update","onUpdatePoint",this)},onUpdatePoint:function(b,a){this.fireEvent("update","points",[a]);this.fireEvent("pointupdate",a)},onAddPoints:function(c,a){var b=this;b.fireEvent("update","add",a.items);a.items.forEach(function(d){b.addPointListeners(d)})},onRemovePoints:function(c,a){var b=this;b.fireEvent("update","remove",a.items);a.items.forEach(function(d){b.addPointListeners(d)})},toArray:function(c){var b=this;var a=[];b.points.each(function(d){a.push(c?d:d.clone().toArray())});return a},toObject:function(){var a=this;return Ext.Object.merge(a.callParent(),{points:a.toArray()})},toString:function(){var b=this;var a=[];b.each(function(c){a.push(c.toString())});return a.join(" ")},toCollection:function(){return this.points.clone()},addPoint:function(a){if(arguments.length==2){points=[arguments[1],arguments[2]]}if(Ext.isArray(a)){a=Ext.create("Khusamov.svg.geometry.Point",a)}return this.points.add(a)},addPoints:function(a){if(arguments.length>1){a=Ext.Array.slice(arguments)}if(Ext.isString(a)){a=Khusamov.svg.geometry.Polyline.parseSvgPointString(a)}if(a instanceof Khusamov.svg.geometry.point.Collection){var b=[];a.each(function(c){b.push(c)});a=b}if(Ext.isArray(a)){a=a.map(function(c){if(Ext.isArray(c)){c=Ext.create("Khusamov.svg.geometry.Point",c)}return c})}if(a instanceof Khusamov.svg.geometry.Polyline){a=a.toArray(true)}return this.points.add(a)},insertPoint:function(b,a){},insertPoints:function(a,b){},removePoint:function(a){this.points.removeAt(a);return this},clear:function(){this.points.removeAll();return this},movePoint:function(b,a){var c=this;if(arguments.length==3){a=[arguments[1],arguments[2]]}c.getPoint(b).move(a);return c},movePointBy:function(){},each:function(b,a){this.points.each(b,a);return this},eachPoint:function(b,a){this.points.each(b,a);return this},eachLine:function(c,b){for(var a=0;a<this.points.getCount();a++){c.call(b,this.getLine(a),a)}return this},getCount:function(){return this.points.getCount()},getLength:function(){var b=this;var a=0;b.each(function(c,d){var e=b.getNextPoint(d);a+=e?c.distance(e):0});return a},getPointById:function(a){return this.points.get(a)},getPoint:function(a){return this.points.getAt(a)},getLine:function(a){return Ext.create("Khusamov.svg.geometry.Line",this.getPoint(a),this.getNextPoint(a))},getNextPoint:function(a){return this.getPoint(a+1)},getPrevPoint:function(a){return this.getPoint(a-1)},getFirstPoint:function(){return this.getPoint(0)},getLastPoint:function(){return this.getPoint(this.getCount()-1)},getMiddlePoint:function(b){var c=this;var e=c.getPoint(b||0);var d=c.getNextPoint(b||0);var a=[(e.x()+d.x())/2,(e.y()+d.y())/2];return Ext.create("Khusamov.svg.geometry.Point",a)},getArea:function(){return Math.abs(this.getRawArea())},getRawArea:function(){var b=this;var a=0;b.each(function(c,d){var e=b.getNextPoint(d);e=e?e:b.getFirstPoint();a+=((e.y()+c.y())/2)*(e.x()-c.x())});return a},isClockwiseDirection:function(){var a=this;return a.getRawArea()>0},turnOut:function(){var a=this;a.points.sortItems(function(c,b){return b.getIndex()-c.getIndex()});return a}});Ext.define("Khusamov.svg.element.Polyline",{extend:"Khusamov.svg.element.Element",requires:["Khusamov.svg.geometry.Polyline"],xtype:"khusamov-svg-element-polyline",isSvgPolyline:true,type:"polyline",baseCls:Ext.baseCSSPrefix+"khusamov-svg-polyline",autoEl:{tag:"polyline"},geometryClass:"Polyline",constructor:function(a){var b=this;if(Ext.isString(a)||Ext.isArray(a)||a instanceof Khusamov.svg.geometry.Polyline){a={geometry:a}}b.callParent([a])},delegates:{geometry:{addPoint:true,addPoints:true,movePoint:true,each:true,clear:true,removePoint:true,insertPoints:false,getMiddlePoint:false,getLastPoint:false,getFirstPoint:false,getPrevPoint:false,getNextPoint:false,getPoint:false,getPointById:false,getCount:false,getLength:false}}},function(a){Khusamov.svg.Element.override({statics:{createPolyline:function(){return a.create.apply(a,arguments)}}})});Ext.define("Khusamov.svg.geometry.vector.Vector",{alternateClassName:"Khusamov.svg.geometry.Vector",extend:"Khusamov.svg.geometry.Point",requires:["Khusamov.svg.geometry.Angle"],uses:["Khusamov.svg.geometry.equation.Linear"],type:"vector",isVector:true,getLength:function(){return this.getRadius()},setLength:function(a){return this.setRadius(a)},getIdentity:function(){return this.clone().setLength(1)},getNormal:function(){return this.clone().rotate(Math.PI/2).setLength(1)},getNormalLinear:function(a){return Khusamov.svg.geometry.equation.Linear.createByParallel(this.getNormal(),a)},getParallelLinear:function(a){return Khusamov.svg.geometry.equation.Linear.createByParallel(this.getIdentity(),a)},getAngleTo:function(b,d,c){var a=Math.acos(this.multiply(b)/this.getLength()*b.getLength());return Ext.create("Khusamov.svg.geometry.Angle",a).get(d,c)},angleTo:function(){return this.getAngleTo.apply(this,arguments)},getAngleBy:function(b,d,c){var a=this.getAngle()-b.getAngle();a=a>=0?a:this.getAngle()+(2*Math.PI-b.getAngle());return Ext.create("Khusamov.svg.geometry.Angle",a).get(d,c)},add:function(a){return new this.self(this.x()+a.x(),this.y()+a.y())},sub:function(a){return new this.self(this.x()-a.x(),this.y()-a.y())},multiply:function(a){return this.x()*a.x()+this.y()*a.y()},scale:function(a){return new this.self(this.x()*a,this.y()*a)},inverse:function(){return this.moveTo(-this.x(),-this.y())},rotate:function(a){return this.moveTo(this.getLength()*Math.cos(this.getAngle()+a),this.getLength()*Math.sin(this.getAngle()+a))},toPoint:function(){return Ext.create("Khusamov.svg.geometry.Point",this)},isCollinear:function(b,d){var a=this.getLength()*b.getLength();var e=this.multiply(b);var c=Math.abs(e)==a;if(d===undefined){return c}if(d===true){return c&&e>0}if(d===false){return c&&e<0}}},function(a){Khusamov.svg.geometry.Point.override({toVector:function(){return new a(this)}})});Ext.define("Khusamov.svg.geometry.equation.Linear",{extend:"Khusamov.svg.geometry.Primitive",requires:["Ext.draw.Matrix","Khusamov.svg.geometry.Point","Khusamov.svg.geometry.vector.Vector","Khusamov.svg.geometry.Angle"],statics:{transform:function(b,c){var e=c.split();var d=Ext.create("Ext.draw.Matrix");d.rotate(e.rotation);var g=Ext.create("Ext.draw.Matrix");g.translate(e.translateX,e.translateY);var f=d.transformPoint(b.getNormalVector().toArray());f=Ext.create("Khusamov.svg.geometry.Vector",f);g.rotate(e.rotation);var a=g.transformPoint(b.b()?[0,b.y(0)]:[b.x(0),0]);return this.createByNormal(f,a)},createByLine:function(a){var c=a.getFirstPoint().x();var e=a.getFirstPoint().y();var b=a.getLastPoint().x();var d=a.getLastPoint().y();return new Khusamov.svg.geometry.equation.Linear({a:e-d,b:b-c,c:c*d-b*e})},createByVector:function(a){},createByPoint:function(a){},createVertical:function(a){return new Khusamov.svg.geometry.equation.Linear(1,0,-a)},createHorizontal:function(a){return new Khusamov.svg.geometry.equation.Linear(0,1,-a)},createByNormal:function(b,a){a=Ext.isArray(a)?new Khusamov.svg.geometry.Point(a):a;return new Khusamov.svg.geometry.equation.Linear({a:b.x(),b:b.y(),c:-(b.x()*a.x()+b.y()*a.y())})},createByParallel:function(b,a){a=Ext.isArray(a)?new Khusamov.svg.geometry.Point(a):a;if(!b.x()){return new Khusamov.svg.geometry.equation.Linear({a:1,b:0,c:-a.x()})}if(!b.y()){return new Khusamov.svg.geometry.equation.Linear({a:0,b:1,c:-a.y()})}return new Khusamov.svg.geometry.equation.Linear({a:1/b.x(),b:-1/b.y(),c:a.y()/b.y()-a.x()/b.x()})}},isLinear:true,type:"linear",config:{a:0,b:0,c:0},constructor:function(a){var b=this;if(arguments.length==3){a={a:arguments[0],b:arguments[1],c:arguments[2]}}b.initConfig(a)},a:function(){return this.getA()},b:function(){return this.getB()},c:function(){return this.getC()},x:function(a){return -(this.b()*a+this.c())/this.a()},y:function(a){return -(this.a()*a+this.c())/this.b()},distance:function(l,e){var g=this;if(Ext.isArray(l)){l=new Khusamov.svg.geometry.Point(l)}var j=g.a();var i=g.b();var f=g.c();var k=l.x();var h=l.y();var d=(j*k+i*h+f)/g.getNormalVectorLength();return e?d:Math.abs(d)},getAngleTo:function(a,c,b){return this.getParallel().getAngleTo(a.getParallel(),c,b)},getAngleBy:function(a,c,b){return this.getParallel().getAngleBy(a.getParallel(),c,b)},getAngle:function(b,a){return this.getParallel().getAngle(b,a)},getTransformLinear:function(a){return Khusamov.svg.geometry.equation.Linear.transform(this,a)},getNormal:function(){return this.getNormalVector().getIdentity()},getNormalLinear:function(a){return Khusamov.svg.geometry.equation.Linear.createByParallel(this.getNormal(),a)},getNormalVector:function(){return Ext.create("Khusamov.svg.geometry.vector.Vector",this.a(),this.b())},getNormalVectorLength:function(){return Math.sqrt(Math.pow(this.a(),2)+Math.pow(this.b(),2))},getParallel:function(){return this.getNormal().getNormal().inverse()},getParallelLinear:function(a){return Khusamov.svg.geometry.equation.Linear.createByParallel(this.getParallel(),a)},getParallelLinearByDestination:function(a){return new this.self({a:this.a(),b:this.b(),c:a*this.getNormalVectorLength()+this.c()})},intersection:function(e){var g=this;var l=null;switch(e.type){case"line":var k=e;l=k.intersection(g);break;case"circular":var j=e;l=j.intersection(g);l=l?l.reverse():l;break;case"linear":var f=e;var b=g.a();var i=g.b();var d=g.c();var a=f.a();var h=f.b();var c=f.c();l=(b*h-a*i==0)?null:Ext.create("Khusamov.svg.geometry.Point",{x:-(d*h-c*i)/(b*h-a*i),y:-(b*c-a*d)/(b*h-a*i)});break}return l},isCollinear:function(a,b){return this.getNormal().isCollinear(a.getNormal(),b)},isParallel:function(c){var f=this;var b=f.a();var e=f.b();var a=c.a();var d=c.b();return b*d-a*e==0},isNormal:function(c){var f=this;var b=f.a();var e=f.b();var a=c.a();var d=c.b();return b*d+a*e==0},toString:function(d){var a=[];function c(f,e){f=d?f.toFixed(d):f;return Number(f)?f+(e||""):""}function b(f,e){var g=arguments.length==2?c(f,e):f;if(g){a.push(g)}}b("Linear");b("{");b(this.a(),"x +");b(this.b(),"y"+(this.c()?" +":""));b(this.c(),null);b("= 0");b("}");return a.join(" ")},toArray:function(){return[this.a(),this.b(),this.c()]},toObject:function(){return Ext.Object.merge(this.callParent(),{a:this.a(),b:this.b(),c:this.c()})}});Ext.define("Khusamov.svg.geometry.Line",{extend:"Khusamov.svg.geometry.Polyline",requires:["Khusamov.svg.geometry.Point","Khusamov.svg.geometry.equation.Linear"],uses:["Khusamov.svg.geometry.equation.Circular"],isLine:true,type:"line",constructor:function(b){var c=this,a=arguments;if(a.length==4){b=[[a[0],a[1]],[a[2],a[3]]]}if(a.length==2){b=[a[0],a[1]]}c.callParent([b])},getParallelByDestination:function(b){var d=this;var a=d.getParallelLinearByDestination(b);var e=a.intersection(d.getFirstNormalLinear());var c=a.intersection(d.getLastNormalLinear());return Ext.create("Khusamov.svg.geometry.Line",e,c)},getParallelLinearByDestination:function(a){return this.toLinear().getParallelLinearByDestination(a)},getFirstNormalLinear:function(){return this.toLinear().getNormalLinear(this.getFirstPoint())},getLastNormalLinear:function(){return this.toLinear().getNormalLinear(this.getLastPoint())},getMiddleNormalLinear:function(){return this.toLinear().getNormalLinear(this.getMiddlePoint())},toLinear:function(){return Khusamov.svg.geometry.equation.Linear.createByLine(this)},getAngle:function(a){return this.toLinear().getAngle(a)},intersection:function(a){return this["intersectionWith"+Ext.String.capitalize(a.type)].call(this,a)},intersectionWithLine:function(a){var b=this.intersectionWithLinear(a.toLinear());if(b){b=a.isInnerPoint(b)?b:null}return b},intersectionWithLinear:function(a){var b=this.toLinear().intersection(a);if(b){b=this.isInnerPoint(b)?b:null}return b},isInnerPoint:function(a){var c=this.getFirstPoint();var b=this.getLastPoint();return(Math.min(c.x(),b.x())<=a.x()&&a.x()<=Math.max(c.x(),b.x())&&Math.min(c.y(),b.y())<=a.y()&&a.y()<=Math.max(c.y(),b.y()))},getInnerPoint:function(b){var c=this;var a=null;var d=Ext.create("Khusamov.svg.geometry.equation.Circular",c.getFirstPoint(),b);var e=d.intersection(c);e.forEach(function(f){if(c.isInnerPoint(f)){a=f}});return a}});Ext.define("Khusamov.svg.element.Line",{extend:"Khusamov.svg.element.Polyline",requires:["Khusamov.svg.geometry.Line"],xtype:"khusamov-svg-element-line",isSvgLine:true,type:"line",baseCls:Ext.baseCSSPrefix+"khusamov-svg-line",autoEl:{tag:"line"},geometryClass:"Line",constructor:function(b){var c=this,a=Ext.Array.slice(arguments);if(arguments.length==4){b=[[a[0],a[1]],[a[2],a[3]]]}if(arguments.length==2){b=[a[0],a[1]]}c.callParent([b])},repaintGeometry:function(){var a=this;if(a.geometryClass&&a.rendered){if(a.getFirstPoint()&&a.getLastPoint()){a.getEl().set({x1:a.getFirstPoint().x(),y1:a.getFirstPoint().y(),x2:a.getLastPoint().x(),y2:a.getLastPoint().y()})}}}},function(a){Khusamov.svg.Element.override({statics:{createLine:function(){return a.create.apply(a,arguments)}}})});Ext.define("Khusamov.svg.element.Marker",{extend:"Khusamov.svg.element.Element",xtype:"khusamov-svg-element-marker",type:"marker",autoEl:{tag:"marker"}});Ext.define("Khusamov.svg.geometry.path.Point",{extend:"Khusamov.svg.geometry.Point",config:{relative:false,segment:null,path:null},constructor:function(a){var b=this;if(arguments.length==1&&Ext.isArray(a)){a={x:a[0],y:a[1],relative:a[2]}}if(arguments.length==2&&Ext.isArray(a)){a={x:a[0],y:a[1],relative:arguments[1]}}if(arguments.length==1&&a instanceof Khusamov.svg.geometry.Point){this.syncWith(a);a={x:a.x(),y:a.y()}}if(arguments.length==2&&a instanceof Khusamov.svg.geometry.Point){this.syncWith(a);a={x:a.x(),y:a.y(),relative:arguments[1]}}if(arguments.length==3){a={x:arguments[0],y:arguments[1],relative:arguments[2]}}b.callParent([a])},syncWith:function(a){var b=this;a.on("update",function(){b.moveTo(a)})},unlinkSegment:function(){this.setSegment(null)},updateSegment:function(b,a){if(a){a.setPoint(null)}},applyRelative:function(a){return !!a},toString:function(){return String(this.x())+" "+String(this.y())},isRelative:function(){return(this.getSegment()&&this.getSegment().isFirst())?false:this.getRelative()},toAbsolute:function(){var a=this.clone();var b=this.getSegment()?this.getSegment().getPrevSegment():this.getPath().getLastSegment();return this.isRelative()?a.move(b.getLastPoint(true)):a}});Ext.define("Khusamov.svg.geometry.path.segment.Segment",{requires:["Khusamov.svg.geometry.path.Point"],config:{path:null,point:[0,0]},constructor:function(a){this.initConfig(a)},applyPoint:function(a){return a?(Ext.isArray(a)?Ext.create("Khusamov.svg.geometry.path.Point",a):a):null},updatePoint:function(a,b){if(b){b.un("update","onParamUpdate",this)}if(a){a.on("update","onParamUpdate",this);a.setSegment(this)}},onParamUpdate:function(){var a=this.getPath();if(a){a.fireEvent("update")}},getPrimitive:Ext.emptyFn,getIndex:function(){var a=this.getPath();return a?a.indexOf(this):null},isFirst:function(){return this.getIndex()==0},isLast:function(){return this.getIndex()==this.getPath().getCount()-1},getNextSegment:function(a){return this.getPath().getNextSegment(this.getIndex())},getPrevSegment:function(a){return this.getPath().getPrevSegment(this.getIndex())},getPoint:function(a){return a?this.callParent().toAbsolute():this.callParent()},getFirstPoint:function(a){return a?this.getPoint().toAbsolute():this.getPoint()},hasPath:function(){return !!this.getPath()},getLastPoint:function(b){var a=this.getPath();return a?(this.isLast()&&!a.closed?(b?a.lastPoint.toAbsolute():a.lastPoint):this.getNextSegment().getFirstPoint(b)):null},getLength:function(){return 0},toString:function(c){var d=this;var b=[];if(d.hasPath()){var a=d.getFirstPoint();if(a){if(d.isFirst()){b.push("M "+d.getFirstPoint().toString())}b.push(c);if(d.isLast()&&d.getPath().closed){b.push("Z")}}}return b.join(" ")},toObject:function(){return{point:this.getPoint().toObject()}},clone:function(){return new this.self(this.toObject())},split:function(b){var a=[];a.push(this.clone());a.push(this.clone());a[1].setPoint(this.getPrimitive().getInnerPoint(b).toArray());return a}});Ext.define("Khusamov.svg.geometry.path.segment.Line",{extend:"Khusamov.svg.geometry.path.segment.Segment",requires:["Khusamov.svg.geometry.Line"],isLineSegment:true,getPrimitive:function(){return this.getLine()},getLine:function(){return Ext.create("Khusamov.svg.geometry.Line",this.getFirstPoint(),this.getLastPoint())},getLength:function(){return this.getLine().getLength()},toString:function(){var c=this,b="";if(c.hasPath()){var a=c.getLastPoint();if(a){b=[];b.push(c.getLastPoint().isRelative()?"l":"L");b.push(c.getLastPoint().toString());b=c.callParent([b.join(" ")])}}return b}});Ext.define("Khusamov.svg.geometry.Polygon",{extend:"Khusamov.svg.geometry.Polyline",isPolygon:true,type:"polygon",getNextPoint:function(b){var c=this;var a=c.callParent([b]);return a?a:c.getFirstPoint()},getPrevPoint:function(b){var c=this;var a=c.callParent([b]);return a?a:c.getLastPoint()},getPerimeter:function(){return this.getLength()},toPolyline:function(){return Ext.create("Khusamov.svg.geometry.Polyline",this.toArray())}},function(){Khusamov.svg.geometry.Polyline.override({toPolygon:function(){return Ext.create("Khusamov.svg.geometry.Polygon",this.toArray())}})});Ext.define("Khusamov.svg.geometry.Triangle",{extend:"Khusamov.svg.geometry.Polygon",requires:["Khusamov.svg.geometry.Point","Khusamov.svg.geometry.equation.Linear"],isTriangle:true,type:"triangle",statics:{createByPerimeter:function(e,d,f){return new (function(h,g,i){this.a=h;this.b=g;this.c=i;this.getPerimeter=function(){return this.a+this.b+this.c};this.getSemiperimeter=function(){return this.getPerimeter()/2};this.getArea=function(){var b=this.getSemiperimeter();var a=Math.sqrt(b*(b-this.a)*(b-this.b)*(b-this.c));return isNaN(a)?0:a};this.ha=function(){return 2*this.getArea()/this.a};this.hb=function(){return 2*this.getArea()/this.b};this.height=this.hb;this.hc=function(){return 2*this.getArea()/this.c};this.ma=function(){return Math.sqrt(2*(Math.pow(this.b,2)+Math.pow(this.c,2))-Math.pow(this.a,2))/2};this.mb=function(){return Math.sqrt(2*(Math.pow(this.a,2)+Math.pow(this.c,2))-Math.pow(this.b,2))/2};this.mc=function(){return Math.sqrt(2*(Math.pow(this.a,2)+Math.pow(this.b,2))-Math.pow(this.c,2))/2}})(e,d,f)}},constructor:function(b){var c=this,a=arguments;if(a.length==6){b=[[a[0],a[1]],[a[2],a[3]],[a[4],a[5]]]}if(a.length==3){b=[a[0],a[1],a[2]]}c.callParent([b])},a:function(){return this.getLine(0).getLength()},b:function(){return this.getLine(1).getLength()},c:function(){return this.getLine(2).getLength()},getSemiperimeter:function(){return this.getPerimeter()/2},getArea:function(){var f=this.getSemiperimeter();var e=this.a(),d=this.b(),g=this.c();return Math.sqrt(f*(f-e)*(f-d)*(f-g))},getHeight:function(a){return 2*this.getArea()/this.getLine(a).getLength()},getMedian:function(b){var a=0;this.eachLine(function(c,d){a+=(d==b?-1:2)*Math.pow(c.getLength(),2)});return Math.sqrt(a)/2},toPolygon:function(){return Ext.create("Khusamov.svg.geometry.Polygon",this.toArray())}});Ext.define("Khusamov.svg.geometry.equation.Circular",{extend:"Khusamov.svg.geometry.Primitive",requires:["Ext.draw.Matrix","Khusamov.svg.geometry.Point","Khusamov.svg.geometry.Triangle"],uses:["Khusamov.svg.geometry.Line"],statics:{findCenter:function(){var h,f,e;if(arguments.length==5){h=[arguments[0],arguments[1]];f=[arguments[2],arguments[3]];e=arguments[4]}if(arguments.length==3){h=arguments[0];f=arguments[1];e=arguments[2]}h=Ext.isArray(h)?h:h.toArray();f=Ext.isArray(f)?f:f.toArray();var l=Ext.create("Khusamov.svg.geometry.Line",h,f);var b=l.getLength();var c=l.toLinear();var i=Ext.create("Ext.draw.Matrix");i.translate(-h[0],-h[1]);i.rotate(-c.getAngle(),h[0],h[1]);var j=b/2;var a=Khusamov.svg.geometry.Triangle;var d=a.createByPerimeter(e,b,e);var g=d.height();var k=[[j,g],[j,-g]];return k.map(function(m){m=i.inverse().transformPoint(m);return Ext.create("Khusamov.svg.geometry.Point",m)})}},isCircular:true,type:"circular",config:{center:[0,0],radius:0},constructor:function(a){var b=this;if(arguments.length>1){a=(arguments.length==3)?{center:[arguments[0],arguments[1]],radius:arguments[2]}:{center:arguments[0],radius:arguments[1]}}b.callParent([a])},applyCenter:function(a){if(!(a instanceof Khusamov.svg.geometry.Point)){a=Ext.create("Khusamov.svg.geometry.Point",a)}return a},intersection:function(i){var p=[];var n,l;var k=this.getRadius();var g=this.getCenter().x();var f=this.getCenter().y();var m=Ext.create("Ext.draw.Matrix");m.translate(-g,-f);var c=Khusamov.svg.geometry.Triangle;if(i.isCircular){var o=i;var b=k;var a=o.getRadius();var d=Ext.create("Khusamov.svg.geometry.Line",this.getCenter(),o.getCenter());var e=d.getLength();var h=d.toLinear();m.rotate(-h.getAngle(),g,f);if(b+a<e){return null}if(Math.abs(b-a)>e){return null}l=c.createByPerimeter(a,e,b).height();n=c.createByPerimeter(b,2*l,b).height();n*=a>b&&c.createByPerimeter(a,2*l,a).height()>e?-1:1;p.push([n,l]);if(b+a>e){p.push([n,-l])}}if(i.isLinear){var j=i;m.rotate(Math.PI/2-j.getAngle(),g,f);j=j.getTransformLinear(m);n=-j.c()/j.a();if(k<Math.abs(n)){return null}l=Math.sqrt(Math.pow(k,2)-Math.pow(n,2));p.push([n,l]);if(k>Math.abs(n)){p.push([n,-l])}}return p.map(function(q){q=m.inverse().transformPoint(q);return Ext.create("Khusamov.svg.geometry.Point",q)})},toString:function(a){var b=function(c){return a!==undefined?c.toFixed(a):c};return Ext.String.format("Circular { (x - {0})^2 + (y - {1})^2 = {2}^2 }",b(this.getCenter().x()),b(this.getCenter().y()),b(this.getRadius()))},toArray:function(){},toObject:function(){}});Ext.define("Khusamov.svg.geometry.Arc",{extend:"Khusamov.svg.geometry.Primitive",requires:["Khusamov.svg.geometry.Point","Khusamov.svg.geometry.equation.Circular","Khusamov.svg.geometry.Line","Khusamov.svg.geometry.equation.Linear","Khusamov.svg.geometry.Angle"],statics:{height:function(f,d,e){var i=[];if(!Ext.isNumber(arguments[0])){var h=Ext.create("Khusamov.svg.geometry.Point",arguments[0]);var g=Ext.create("Khusamov.svg.geometry.Point",arguments[1]);var a=arguments[2];f=h.distance(a);d=h.distance(g);var b=(a.x()-h.x())*(g.y()-h.y())-(a.y()-h.y())*(g.x()-h.x());e=b>0?1:0}var c=4*f*f-d*d;i[0]=f-Math.sqrt(c)/2;i[1]=f+Math.sqrt(c)/2;return i[e?e:0]},radius:function(b,d){var a=Infinity;if(b){var c=b>=0?1:-1;b=Math.abs(b);a=b/2+d*d/(8*b);a*=c}return a}},isArc:true,type:"arc",config:{firstPoint:null,lastPoint:null,radius:[0,0],rotation:0,large:false,sweep:false},constructor:function(a){if(arguments.length>1){a=arguments[3]||{};a.firstPoint=arguments[0];a.lastPoint=arguments[1];a.radius=arguments[2]}this.callParent([a])},onParamUpdate:function(){this.fireEvent("update")},applyFirstPoint:function(a){return a?(Ext.isArray(a)?Ext.create("Khusamov.svg.geometry.Point",a):a):null},updateFirstPoint:function(a,b){this.onParamUpdate();if(b){b.un("update","onParamUpdate",this)}if(a){a.on("update","onParamUpdate",this)}},applyLastPoint:function(a){return this.applyFirstPoint(a)},updateLastPoint:function(a,b){this.updateFirstPoint(a,b)},updateRadius:function(){this.onParamUpdate()},updateRotation:function(){this.onParamUpdate()},updateLarge:function(){this.onParamUpdate()},updateSweep:function(){this.onParamUpdate()},applyRadius:function(a){return Ext.isArray(a)?a:[a,a]},getRadius:function(c){var a=this.callParent();var b=a[0]==a[1];c=b?0:c;return c!==undefined?a[c]:a},isLarge:function(){return this.getLarge()},isSweep:function(){return this.getSweep()},isCircular:function(){return this.getRadius(0)==this.getRadius(1)},isElliptical:function(){return !this.isCircular()},xor:function(d,c){return d?!c:c},getCenterIndex:function(){return this.xor(this.isSweep(),this.isLarge())?0:1},getCenter:function(b){if(this.isCircular()){var a=Khusamov.svg.geometry.equation.Circular.findCenter(this.getFirstPoint(),this.getLastPoint(),this.getRadius())[this.getCenterIndex()];return a}},getFirstRadiusLinear:function(){if(this.isCircular()){return Ext.create("Khusamov.svg.geometry.Line",this.getCenter(),this.getFirstPoint()).toLinear()}},getLastRadiusLinear:function(){if(this.isCircular()){return Ext.create("Khusamov.svg.geometry.Line",this.getCenter(),this.getLastPoint()).toLinear()}},getRadiusLinear:function(a){if(this.isCircular()){return Ext.create("Khusamov.svg.geometry.Line",this.getCenter(),a).toLinear()}},getChord:function(){return Ext.create("Khusamov.svg.geometry.Line",this.getFirstPoint().clone(),this.getLastPoint().clone())},getAngle:function(b,a){var c=Math.acos(1-Math.pow(this.getChordLength(),2)/(2*Math.pow(this.getRadius(),2)));if(!isNaN(c)){c=this.isLarge()?2*Math.PI-c:c;c=Ext.create("Khusamov.svg.geometry.Angle",c).get(b,a)}return c},getLength:function(){var a=0;if(this.isCircular()){a=this.getRadius()*this.getAngle()}return a},getChordLength:function(){return this.getChord().getLength()},getHeight:function(){return Khusamov.svg.geometry.Arc.height(this.getFirstPoint(),this.getLastPoint(),this.getCenter())},intersection:function(a){return this["intersectionWith"+Ext.String.capitalize(a.type)].call(this,a)},intersectionWithLine:function(b){var c=this;var a=null;var d=c.toCircular().intersection(b.toLinear());if(d){a=[];d.forEach(function(e){if(c.isInnerPoint(e)&&b.isInnerPoint(e)){a.push(e)}});a=a.length?a:null}return a},intersectionWithLinear:function(b){var c=this;var a=null;var d=c.toCircular().intersection(b);if(d){a=[];d.forEach(function(e){if(c.isInnerPoint(e)){a.push(e)}});a=a.length?a:null}return a},isInnerPoint:function(a){var c=this.getFirstRadiusLinear();var f=this.getLastRadiusLinear();var d=this.getRadiusLinear(a);var e=f.getAngle();var b;if(this.isSweep()){e=f.getAngleBy(c);b=d.getAngleBy(c)}else{e=c.getAngleBy(f);b=d.getAngleBy(f)}return b>=0&&b<=e},toCircular:function(){return Ext.create("Khusamov.svg.geometry.equation.Circular",this.getCenter(),this.getRadius())},split:function(b){var a=null;var e=this.intersectionWithLinear(b);if(e){a=[];var c=[].concat(this.getFirstPoint(),e,this.getLastPoint());var d;c.forEach(function(f,h){if(h!=0){var g=this.clone();g.setFirstPoint(d);g.setLastPoint(f);a.push(g)}d=f})}return a},toObject:function(){var a=this;return Ext.Object.merge(a.callParent(),{firstPoint:a.getFirstPoint(),lastPoint:a.getLastPoint(),radius:a.getRadius(),rotation:a.getRotation(),large:a.getLarge(),sweep:a.getSweep()})},getInnerPoint:function(b){var c=this;var a=null;var d=Ext.create("Khusamov.svg.geometry.equation.Circular",c.getFirstPoint(),b);var e=d.intersection(c);e.forEach(function(f){if(c.isInnerPoint(f)){a=f}});return a}});Ext.define("Khusamov.svg.geometry.path.segment.Arc",{extend:"Khusamov.svg.geometry.path.segment.Segment",requires:["Khusamov.svg.geometry.Arc"],isArcSegment:true,config:{arc:null},constructor:function(b,a,c){var d=this;c=c?{arc:c}:{};if(arguments.length==1){c=b}if(b instanceof Khusamov.svg.geometry.Arc){c={arc:b}}if(arguments.length>1){c.arc=c.arc||{};if(!Ext.isEmpty(a)){c.arc.radius=a}if(!Ext.isEmpty(b)){c.point=b}}d.callParent([c]);d.initArcPoints()},getPrimitive:function(){return this.getArc()},applyArc:function(a){if(!(a instanceof Khusamov.svg.geometry.Arc)){a=Ext.create("Khusamov.svg.geometry.Arc",a)}return a},updateArc:function(a,b){this.onParamUpdate();if(b){a.un("update","onParamUpdate",this)}a.on("update","onParamUpdate",this)},initArcPoints:function(){var b=this,a=b.getArc();if(a){a.setFirstPoint(b.getFirstPoint());if(b.getLastPoint()){a.setLastPoint(b.getLastPoint())}}},updatePoint:function(a,b){this.callParent(arguments);this.initArcPoints()},updatePath:function(b){var a=this;["add","splice","clear","changelastpoint","turnout"].forEach(function(c){b.on(c,"initArcPoints",a)});a.initArcPoints()},toObject:function(){return Ext.Object.merge(this.callParent(),{arc:this.getArc().toObject()})},toString:function(){var d=this,b="";if(d.hasPath()){var c=d.getArc();var a=c.getLastPoint();if(a){b=[];b.push(a.isRelative()?"a":"A");b.push(c.getRadius(0));b.push(c.getRadius(1));b.push(c.getRotation());b.push(c.isLarge()?1:0);b.push(c.isSweep()?1:0);b.push(a.toString());b=d.callParent([b.join(" ")])}}return b}});Ext.define("Khusamov.svg.geometry.Path",{extend:"Khusamov.svg.geometry.Primitive",requires:["Ext.util.Collection","Khusamov.svg.geometry.path.segment.Line","Khusamov.svg.geometry.path.segment.Arc","Khusamov.svg.geometry.Arc","Khusamov.svg.geometry.equation.Linear","Khusamov.svg.discrete.graph.AdjacencyList","Khusamov.svg.geometry.Line"],isPath:true,type:"path",constructor:function(){this.callParent(arguments);this.segments=[];this.closed=false;this.lastPoint=null},add:function(a){a.setPath(this);this.segments.push(a);this.closed=true;this.lastPoint.un("update","onLastPointUpdate",this);this.lastPoint=null;this.fireEvent("add");this.fireEvent("update");return a},splice:function(a,b,c){this.segments.splice(a,b,c);this.fireEvent("splice");this.fireEvent("update");return c},replace:function(a,c,b){if(b){c.setPoint(this.getPoint(a))}return this.splice(a,1,c)},insert:function(a,b){return this.splice(a,0,b)},indexOf:function(a){return this.segments.indexOf(a)},getCount:function(){return this.segments.length},clear:function(){this.segments=[];this.closed=false;if(this.lastPoint){this.lastPoint.un("update","onLastPointUpdate",this);this.lastPoint=null}this.fireEvent("clear");this.fireEvent("update");return this},getSegment:function(a){return this.segments[a]},getFirstSegment:function(){return this.getSegment(0)},getLastSegment:function(){return this.getSegment(this.getCount()-1)},getNextSegment:function(a){var b=this.getSegment(a+1);return b?b:this.getFirstSegment()},getPrevSegment:function(a){var b=this.getSegment(a-1);return b?b:this.getLastSegment()},eachSegment:function(b,a){this.segments.forEach(b,a);return this},toString:function(){var b=this;var a=[];b.segments.forEach(function(c){a.push(c.toString())});return a.join(" ")},point:function(){var a=null;if(arguments[0] instanceof Khusamov.svg.geometry.path.Point){a=arguments[0];if(arguments.length==2){a.setRelative(arguments[1])}}else{if(arguments.length==1){a=arguments[0];a=Ext.create("Khusamov.svg.geometry.path.Point",a)}if(arguments.length==2&&!Ext.isNumber(arguments[0])){a=Ext.create("Khusamov.svg.geometry.path.Point",arguments[0],arguments[1])}if((arguments.length==3||arguments.length==2)&&Ext.isNumber(arguments[0])){a=Ext.Array.slice(arguments);a=Ext.create("Khusamov.svg.geometry.path.Point",a)}}this.lastPoint=a;this.lastPoint.on("update","onLastPointUpdate",this);this.lastPoint.setPath(this);this.closed=false;this.fireEvent("changelastpoint");this.fireEvent("update");return this},onLastPointUpdate:function(){this.fireEvent("update")},segment:function(a){a.setPoint(this.lastPoint);this.add(a);return this},line:function(){return this.segment(Ext.create("Khusamov.svg.geometry.path.segment.Line"))},arc:function(a,b){var c=null;var d=Khusamov.svg.geometry.path.segment.Arc;if(a instanceof Khusamov.svg.geometry.Arc){c=d.create(a)}else{if(!(Ext.isArray(a)||Ext.isNumeric(a))){b=a;a=null}c=d.create(null,a,b)}return this.segment(c)},replaceOfLine:function(a){return this.replace(Ext.create("Khusamov.svg.geometry.path.segment.Line"),true)},replaceOfArc:function(c,a,b){return this.replace(Ext.create("Khusamov.svg.geometry.path.segment.Arc",null,a,b),true)},getPoint:function(a){var c=this;var b=c.getSegment(a);return b?b.getPoint():((!c.closed&&a==c.getCount())?c.lastPoint:null)},getFirstPoint:function(){return this.getPoint(0)},getPoints:function(){var a=[];this.segments.forEach(function(b){a.push(b.getPoint())});if(this.lastPoint){a.push(this.lastPoint)}return a},eachPoint:function(b,a){this.getPoints().forEach(b,a);return this},getPolygonRawArea:function(){var b=this;var a=0;b.eachPoint(function(c,d){var e=b.getPoint(d+1);e=e?e:b.getPoint(0);a+=((e.y()+c.y())/2)*(e.x()-c.x())});return a},isClockwiseDirection:function(){return this.getPolygonRawArea()>0},turnOut:function(){var b=this;var a=b.getPoints().sort(function(c,d){return d.getIndex()-c.getIndex()});b.segments.sort(function(d,c){return c.getIndex()-d.getIndex()});a.forEach(function(c,d){var e=b.getSegment(d);c.unlinkSegment();if(e){e.setPoint(c)}else{b.lastPoint=c;b.lastPoint.on("update","onLastPointUpdate",b)}});b.fireEvent("turnout");b.fireEvent("update");return b},getLength:function(){var a=0;this.eachSegment(function(b){a+=b.getLength()});return a},intersection:function(a,b){return this["intersectionWith"+Ext.String.capitalize(a.type)].call(this,a,b)},intersectionWithLinear:function(b,c){var a=[],d=0;this.eachSegment(function(f,e){var g=f.getPrimitive().intersection(b);if(g){a=a.concat(g);if(c){g=Ext.isArray(g)?g:[g];g.forEach(function(h){var i=f.getFirstPoint().getDistanceTo(h);h.segment={index:e,distance:i,distanceByPath:d+i}});d+=f.getLength()}}});return a.length?a:null},split:function(a){return this["splitWith"+Ext.String.capitalize(a.type)].call(this,a)},splitWithLinear:function(d){var g=this;var j=[];var a=g.intersectionWithLinear(d,true);if(a){var b=Ext.create("Khusamov.svg.geometry.Line",a[0],a[a.length-1]).toLinear();var h=Ext.create("Khusamov.svg.discrete.graph.AdjacencyList",{directed:true});var e=[];a.forEach(function(k,l){var o=k.segment;var p=o.distance;e.push(o.index);var n=g.getSegment(o.index).getLength();var m=g.getSegment(o.index).isLast();if(l%2==0){h.add("p"+o.index,"i"+l,p);h.add("p"+(m?0:(o.index+1)),"i"+l,n-p);h.add("i"+l,"i"+(l+1),a[l+1].distance(k))}else{h.add("i"+l,"p"+o.index,p);h.add("i"+l,"p"+(m?0:(o.index+1)),n-p)}});g.eachSegment(function(o,k){var n=o.isLast();if(!Ext.Array.contains(e,k)){var q="p"+k,p="p"+(n?0:(k+1)),m=o.getLength();var l=g.isClockwiseDirection();if(b.distance(o.getFirstPoint(),true)>0?!l:l){h.add(q,p,m)}else{h.add(p,q,m)}}});console.log("ГРАФ",h.graph,g.isClockwiseDirection());var c=[];function f(l){var k=false;c.forEach(function(m){if(Ext.Array.contains(m,l)){k=true;return false}});return k}function i(k){if(!f(k)){c.push(h.findBackPath(k))}}a.forEach(function(k){var l=g.getSegment(k.segment.index).isLast();i("p"+k.segment.index);i("p"+(l?0:(k.segment.index+1)))});c.forEach(function(k){var l=new g.self();k.forEach(function(n){var m=(n[0]=="p")?g.getPoint(n.substring(1)).clone():a[n.substring(1)];l.point(m);l.line()});j.push(l)})}return j.length?j:null},splitByPointPair:function(g,e,d){var c=this;var f=c.getSegment(g.index);var a=c.getSegment(e.index);var b=a;while(b.getNextSegment().getIndex()!=f.getIndex()){b=b.getNextSegment()}}});Ext.define("Khusamov.svg.element.Path",{extend:"Khusamov.svg.element.Element",requires:["Khusamov.svg.geometry.Path"],xtype:"khusamov-svg-element-path",isSvgPath:true,type:"path",baseCls:Ext.baseCSSPrefix+"khusamov-svg-path",autoEl:{tag:"path"},geometryClass:"Path",geometryAttributeName:"d",constructor:function(a){var b=this;if(Ext.isString(a)||Ext.isArray(a)||a instanceof Khusamov.svg.geometry.Path){a={geometry:a}}b.callParent([a])}},function(a){Khusamov.svg.Element.override({statics:{createPath:function(){return a.create.apply(a,arguments)}}})});Ext.define("Khusamov.svg.element.Polygon",{extend:"Khusamov.svg.element.Polyline",requires:["Khusamov.svg.geometry.Polygon"],xtype:"khusamov-svg-element-polygon",isSvgPolygon:true,type:"polygon",baseCls:Ext.baseCSSPrefix+"khusamov-svg-polygon",autoEl:{tag:"polygon"},geometryClass:"Polygon",delegates:{geometry:{getNextPoint:false,getPrevPoint:false,getPerimeter:false}}},function(a){Khusamov.svg.Element.override({statics:{createPolygon:function(){return a.create.apply(a,arguments)}}})});Ext.define("Khusamov.svg.element.Rect",{extend:"Khusamov.svg.element.Element",xtype:"khusamov-svg-element-rect",type:"rect",autoEl:{tag:"rect"}});Ext.define("Khusamov.svg.element.Text",{extend:"Khusamov.svg.element.Element",xtype:"khusamov-svg-element-text",isSvgText:true,type:"text",baseCls:Ext.baseCSSPrefix+"khusamov-svg-text",autoEl:{tag:"text"},config:{textBaseline:[0,0]},constructor:function(a){var b=this;if(arguments.length>1){a=(arguments.length==3)?{textBaseline:[arguments[0],arguments[1]],html:arguments[2]}:{textBaseline:arguments[0],html:arguments[1]}}b.callParent([a])},applyTextBaseline:function(a){return Ext.isArray(a)?Ext.create("Khusamov.svg.geometry.Point",a):a},updateTextBaseline:function(a,b){var c=this;if(b){b.un("update","onUpdateTextBaselinePoint",c)}a.on("update","onUpdateTextBaselinePoint",c);if(c.rendered){c.getEl().set({x:a.x(),y:a.y()})}},onUpdateTextBaselinePoint:function(){if(this.rendered){this.getEl().set({x:this.getTextBaseline().x(),y:this.getTextBaseline().y()})}this.fireEvent("update")},afterRender:function(){var a=this;a.callParent(arguments);a.getEl().set({x:a.getTextBaseline().x(),y:a.getTextBaseline().y()})}},function(a){Khusamov.svg.Element.override({statics:{createText:function(){return a.create.apply(a,arguments)}}})});Ext.define("Khusamov.svg.element.Title",{extend:"Khusamov.svg.element.Element",xtype:"khusamov-svg-element-title",isSvgTitle:true,type:"title",baseCls:Ext.baseCSSPrefix+"khusamov-svg-title",autoEl:{tag:"title"},constructor:function(a){var b=this;a=Ext.isPrimitive(a)?{html:a}:a;b.callParent([a])}},function(a){Khusamov.svg.Element.override({statics:{createTitle:function(){return a.create.apply(a,arguments)}}})});Ext.define("Khusamov.svg.geometry.path.PathSet",{extend:"Khusamov.svg.geometry.Primitive",isPathSet:true,type:"pathset",config:{paths:[]},add:function(a){this.getPaths().push(a);this.fireEvent("update");return this},eachPath:function(b,a){this.getPaths().forEach(b,a);return this},clear:function(){this.setPaths([]);return this},toString:function(){var a=[];this.getPaths().forEach(function(b){a.push(b.toString())});return a.join(" ")}});Ext.define("Khusamov.svg.geometry.path.Command",{requires:["Ext.data.identifier.Sequential"],mixins:["Ext.mixin.Factoryable"],factoryConfig:{type:"khusamov.svg.geometry.path.command"},statics:{map:{},typeByLetter:function(a){return this.map[a].toLowerCase()},xclassPrefix:null,configFromString:function(b){b=b.split(" ");var a=b[0];b.shift();return{type:this.typeByLetter(a),parameters:b}},identifier:null,init:function(){this.identifier=Ext.create("Ext.data.identifier.Sequential")},generateId:function(){return this.identifier.generate()}},letter:null,config:{id:0,parameters:[]},constructor:function(a){var b=this;a=a||{};b.initConfig(a)},applyId:function(a){return a?a:Khusamov.svg.geometry.path.Command.generateId()},setParameter:function(a,b){this.getParameters()[a]=b;return this},toString:function(){return this.toArray().join(" ")},toArray:function(){return[this.letter].concat(this.getParameters())},toObject:function(){},clone:function(){return new this.self(this.toObject())}},function(a){a.init();a.onExtended(function(b,d){var c=b.getName().split(".");c=Ext.String.uncapitalize(c[c.length-1]);a.map[d.letter]=c})});Ext.define("Khusamov.svg.geometry.path.Arc",{extend:"Khusamov.svg.geometry.path.Command",alias:"khusamov.svg.geometry.path.command.arc",requires:["Khusamov.svg.geometry.Point"],letter:"A",config:{point:[0,0],radius:[0,0],xAxisRotation:0,largeArcFlag:false,sweepFlag:false},constructor:function(b,a,c){var e=this;c=c||{};if(arguments.length==1){c=b;var d=c.parameters;c.point=[d[5],d[6]];c.radius=[d[0],d[1]];c.xAxisRotation=d[2];c.largeArcFlag=!!d[3];c.sweepFlag=!!d[4]}if(arguments.length>1){c.point=b;c.radius=a}e.callParent([c])},updateXAxisRotation:function(a){this.setParameter(2,a)},updateLargeArcFlag:function(a){this.setParameter(3,a?1:0)},updateSweepFlag:function(a){this.setParameter(4,a?1:0)},applyPoint:function(a){return Ext.isArray(a)?Ext.create("Khusamov.svg.geometry.Point",a):a},updatePoint:function(a){this.setParameter(5,a.x());this.setParameter(6,a.y())},applyRadius:function(a){a=Ext.isNumeric(a)?[a,a]:a;return Ext.isArray(a)?Ext.create("Khusamov.svg.geometry.Point",a):a},updateRadius:function(a){this.setParameter(0,a.x());this.setParameter(1,a.y())},toObject:function(){var a=this;return Ext.Object.merge(a.callParent(),{point:a.getPoint().toArray()})}});Ext.define("Khusamov.svg.geometry.path.ArcBy",{extend:"Khusamov.svg.geometry.path.Command",alias:"khusamov.svg.geometry.path.command.arcby",letter:"a"});Ext.define("Khusamov.svg.geometry.path.Close",{extend:"Khusamov.svg.geometry.path.Command",alias:"khusamov.svg.geometry.path.command.close",requires:["Khusamov.svg.geometry.Point"],letter:"Z"});Ext.define("Khusamov.svg.geometry.path.Move",{extend:"Khusamov.svg.geometry.path.Command",alias:"khusamov.svg.geometry.path.command.move",requires:["Khusamov.svg.geometry.Point"],letter:"M",config:{point:[0,0]},constructor:function(a){var b=this;if(arguments.length==2){a=Ext.Array.slice(arguments)}if(a instanceof Khusamov.svg.geometry.Point){a={point:a}}if(Ext.isArray(a)){a={point:a}}if(a&&a.parameters){a.point=a.parameters}b.callParent([a])},applyPoint:function(a){return Ext.isArray(a)?Ext.create("Khusamov.svg.geometry.Point",a):a},updatePoint:function(a){this.setParameter(0,a.x());this.setParameter(1,a.y())},toObject:function(){var a=this;return Ext.Object.merge(a.callParent(),{point:a.getPoint().toArray()})}});Ext.define("Khusamov.svg.geometry.path.Line",{extend:"Khusamov.svg.geometry.path.Move",alias:"khusamov.svg.geometry.path.command.line",letter:"L"});Ext.define("Khusamov.svg.geometry.path.LineBy",{extend:"Khusamov.svg.geometry.path.Line",alias:"khusamov.svg.geometry.path.command.lineby",letter:"l"});Ext.define("Khusamov.svg.geometry.path.MoveBy",{extend:"Khusamov.svg.geometry.path.Move",alias:"khusamov.svg.geometry.path.command.moveby",letter:"m"});Ext.define("Khusamov.svg.geometry.path.Subpath",{segments:null,config:{closed:false,lastPoint:null},constructor:function(a){var b=this;b.initConfig(a);b.segments=[]},applyLastPoint:function(a){a=Ext.isArray(a)?Ext.create("Khusamov.svg.geometry.path.Point",a):a;a.setSubpath(this);return a},getLastPoint:function(a){return a?this.callParent().toAbsolute():this.callParent()},add:function(a){a.setSubpath(this);this.segments.push(a);return a},indexOf:function(a){return this.segments.indexOf(a)},getCount:function(){return this.segments.length},clear:function(){this.segments=[]},isClosed:function(){return this.getClosed()},close:function(){this.setClosed(true)},open:function(){this.setClosed(false)},getSegment:function(a){return this.segments[a]},getFirstSegment:function(){return this.getSegment(0)},getLastSegment:function(){return this.getSegment(this.getCount()-1)},getNextSegment:function(a){var b=this.getSegment(a+1);return b?b:this.getFirstSegment()},getPrevSegment:function(a){var b=this.getSegment(a-1);return b?b:this.getLastSegment()},toString:function(){var b=this;var a=[];b.segments.forEach(function(c){a.push(c.toString())});return a.join(" ")},eachSegment:function(b,a){this.segments.forEach(b,a)},getPoint:function(a){var b=this.getSegment(a);return b?b.getPoint():this.getLastPoint()},getPoints:function(){var a=[];this.segments.forEach(function(c){a.push(c.getPoint())});var b=this.getLastPoint();if(b){a.push(b)}return a},eachPoint:function(b,a){this.getPoints().forEach(b,a)},getPolygonRawArea:function(){var b=this;var a=0;b.eachPoint(function(c,d){var e=b.getPoint(d+1);e=e?e:b.getPoint(0);a+=((e.y()+c.y())/2)*(e.x()-c.x())});return a},isClockwiseDirection:function(){var a=this;return a.getPolygonRawArea()>0},turnOut:function(){var b=this;var a=b.getPoints().sort(function(c,d){return d.getIndex()-c.getIndex()});this.segments.sort(function(c,d){return d.getIndex()-c.getIndex()});a.forEach(function(c,d){var e=b.getSegment(d);if(e){e.setPoint(c)}else{b.setLastPoint(c)}});return b}});Ext.define("Khusamov.text.Highlight",{extend:"Ext.Component",alias:"widget.highlight",scrollable:true,renderTpl:["<tpl if='renderScroller'>","<div class='{scrollerCls}' style='{%this.renderPadding(out, values)%}'>","</tpl>","<pre id='{id}-preEl' data-ref='preEl' style='margin: 0;'>","<code id='{id}-codeEl' data-ref='codeEl'>","{%this.renderContent(out,values)%}","</pre>","</code>","<tpl if='renderScroller'></div></tpl>"],childEls:["preEl","codeEl"],config:{type:"ace",text:null,gutter:true,trim:true,wrap:false,fontSize:"15px"},constructor:function(){this.highlighter={};this.callParent(arguments)},updateText:function(a){if(a){if(this.rendered){this.codeEl.setHtml(a);this.highlight()}else{this.on("render","highlight",this,{args:[a]})}}},getHighlighter:function(a){var b=this;if(!b.highlighter[a]){b.highlighter[a]=b.createHighlighter(a)}return b.highlighter[a]},createHighlighter:function(a){return ace.require("ace/ext/static_highlight")},highlight:function(c){var b=this;c&&b.codeEl.setHtml(c);b.getHighlighter("ace").highlight(this.codeEl.dom,{mode:"ace/mode/javascript",theme:"ace/theme/eclipse",trim:b.getTrim(),showGutter:b.getGutter(),useWrapMode:b.getWrap()});if(!b.correctedStyles){b.correctedStyles=true;var a=Ext.util.CSS.createStyleSheet(".ace_line { line-height: normal; }");if(!b.getWrap()){Ext.util.CSS.createRule(a,".ace_static_highlight","white-space: pre;")}Ext.util.CSS.createRule(a,".ace_static_highlight","font-size: "+b.getFontSize()+";");if(b.getGutter()){Ext.util.CSS.createRule(a,".ace_gutter","z-index: initial;");Ext.util.CSS.createRule(a,".ace-clouds .ace_gutter","background: white;");Ext.util.CSS.createRule(a,".ace-clouds .ace_gutter","color: silver;");Ext.util.CSS.createRule(a,".ace-eclipse .ace_gutter","background: #F5F5F5;");Ext.util.CSS.createRule(a,".ace-eclipse .ace_gutter","color: rgb(125, 125, 125);");Ext.util.CSS.createRule(a,".ace_static_highlight .ace_gutter","padding: 0 8px 0 0;");Ext.util.CSS.createRule(a,".ace_static_highlight .ace_gutter","width: 2.7em;");Ext.util.CSS.createRule(a,".ace_static_highlight.ace_show_gutter .ace_line","padding-left: 3.6em;")}}}});